<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 Fire22 Manager Dashboard - Core Edition v4.0.0-staging</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
            margin: 0; 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0; 
            min-height: 100vh;
        }
        .header { 
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            padding: 1.5rem; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid #475569;
        }
        .kpi-card { 
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            padding: 1.5rem; 
            border-radius: 1rem; 
            text-align: center;
            border: 1px solid #475569;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .kpi-value { 
            font-size: 2.5rem; 
            font-weight: 800; 
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .kpi-label { 
            font-size: 0.9rem; 
            color: #94a3b8; 
            font-weight: 500;
            margin-top: 0.5rem;
        }
        .tab-button { 
            padding: 0.75rem 1.5rem; 
            border-radius: 0.75rem; 
            cursor: pointer; 
            transition: all 0.3s ease;
            font-weight: 500;
            border: 1px solid transparent;
        }
        .tab-button.active { 
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.3);
        }
        .tab-button:not(.active):hover { 
            background: #475569;
            border-color: #6366f1;
        }
        .status-badge { 
            padding: 0.5rem 1rem; 
            border-radius: 0.75rem; 
            font-size: 0.75rem; 
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .status-active { 
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.3);
        }
        .status-restricted { 
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(245, 158, 11, 0.3);
        }
        .status-inactive { 
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(239, 68, 68, 0.3);
        }
        .permission-yes { color: #10b981; font-weight: 600; }
        .permission-no { color: #ef4444; font-weight: 600; }
        .permission-icon { font-size: 1.25rem; }
        .permission-allow { color: #10b981; }
        .permission-deny { color: #ef4444; }
        .table-container {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 1rem;
            border: 1px solid #475569;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        .table-header {
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
            border-bottom: 1px solid #64748b;
        }
        .table-row:hover {
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
            transform: scale(1.01);
            transition: all 0.2s ease;
        }
        .input-field {
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            color: #e2e8f0;
            transition: all 0.3s ease;
        }
        .input-field:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            border-radius: 0.75rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.3);
        }
        .btn-secondary {
            background: #475569;
            color: #e2e8f0;
            border: 1px solid #64748b;
            border-radius: 0.75rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background: #64748b;
            border-color: #94a3b8;
        }
        
        /* Enhanced Branding Styles */
        .brand-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 3rem;
            animation: flame-flicker 2s ease-in-out infinite alternate;
        }
        
        @keyframes flame-flicker {
            0%, 100% { transform: scale(1) rotate(-2deg); }
            50% { transform: scale(1.1) rotate(2deg); }
        }
        
        .logo-text {
            display: flex;
            flex-direction: column;
        }
        
        .company-name {
            font-size: 2.5rem;
            margin: 0;
            background: linear-gradient(90deg, #fdbb2d, #b21f1f);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
            letter-spacing: 2px;
        }
        
        .company-tagline {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
            letter-spacing: 1px;
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 25px;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            font-weight: 500;
        }
        
        .nav-link:hover {
            color: #fdbb2d;
            background: rgba(253, 187, 45, 0.1);
            border-color: rgba(253, 187, 45, 0.3);
            transform: translateY(-2px);
        }
        
        /* Enhanced Card Styling with Brand Colors */
        .kpi-card {
            background: linear-gradient(135deg, rgba(253, 187, 45, 0.1), rgba(178, 31, 31, 0.1));
            border: 1px solid rgba(253, 187, 45, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(253, 187, 45, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .kpi-card:hover::before {
            left: 100%;
        }
        
        .kpi-card:hover {
            transform: translateY(-5px);
            border-color: rgba(253, 187, 45, 0.4);
            box-shadow: 0 20px 40px rgba(253, 187, 45, 0.2);
        }
        
        .kpi-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, #fdbb2d, #b21f1f);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 0.5rem;
        }
        
        .kpi-label {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }
        
        /* Enhanced Tab Styling */
        .tab-button {
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid transparent;
            border-radius: 0.75rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .tab-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(253, 187, 45, 0.1), transparent);
            transition: left 0.3s ease;
        }
        
        .tab-button:hover::before {
            left: 100%;
        }
        
        .tab-button:hover {
            background: rgba(253, 187, 45, 0.1);
            border-color: rgba(253, 187, 45, 0.3);
            transform: translateY(-2px);
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, rgba(253, 187, 45, 0.2), rgba(178, 31, 31, 0.2));
            color: #fdbb2d;
            border-color: rgba(253, 187, 45, 0.4);
            box-shadow: 0 5px 15px rgba(253, 187, 45, 0.2);
        }
        
        /* Enhanced Table Styling */
        .table-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 1rem;
            border: 1px solid rgba(253, 187, 45, 0.1);
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .table-header {
            background: linear-gradient(135deg, rgba(253, 187, 45, 0.1), rgba(178, 31, 31, 0.1));
            border-bottom: 2px solid rgba(253, 187, 45, 0.2);
        }
        
        .table-header th {
            color: #fdbb2d;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Enhanced Input Styling */
        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(253, 187, 45, 0.2);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            color: white;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #fdbb2d;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 20px rgba(253, 187, 45, 0.3);
        }
        
        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* Enhanced Button Styling */
        .btn-primary {
            background: linear-gradient(135deg, #fdbb2d, #b21f1f);
            color: white;
            border: none;
            border-radius: 0.75rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.3s ease;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(253, 187, 45, 0.4);
        }
        
        /* Responsive Branding */
        @media (max-width: 768px) {
            .brand-logo {
                flex-direction: column;
                text-align: center;
            }
            
            .company-name {
                font-size: 2rem;
            }
            
            .logo-icon {
                font-size: 2.5rem;
            }
            
            .nav-link {
                font-size: 0.9rem;
                padding: 8px 12px;
            }
        }
        
        /* Footer Branding Styles */
        .footer {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin-top: 50px;
            text-align: center;
            border-top: 2px solid rgba(253, 187, 45, 0.3);
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-brand {
            margin-bottom: 30px;
        }
        
        .footer-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .footer-logo-icon {
            font-size: 2.5rem;
            animation: flame-flicker 2s ease-in-out infinite alternate;
        }
        
        .footer-logo-text {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .footer-company {
            font-size: 2rem;
            color: #fdbb2d;
            margin-bottom: 5px;
            font-weight: 700;
            letter-spacing: 2px;
        }
        
        .footer-tagline {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
            font-style: italic;
        }
        
        .footer-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .footer-section h4 {
            color: #fdbb2d;
            font-size: 1.2rem;
            margin-bottom: 15px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .footer-section a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            display: block;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            padding: 5px 0;
            border-radius: 5px;
        }
        
        .footer-section a:hover {
            color: #fdbb2d;
            background: rgba(253, 187, 45, 0.1);
            transform: translateX(5px);
        }
        
        .footer-divider {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin: 30px 0;
        }
        
        .footer-copyright {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }
        
        .footer-copyright p {
            margin-bottom: 5px;
        }
        
        .footer-copyright small {
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* Enhanced Animation for Brand Elements */
        .brand-logo:hover .logo-icon {
            animation: flame-flicker 0.5s ease-in-out infinite alternate;
        }
        
        .footer-logo:hover .footer-logo-icon {
            animation: flame-flicker 0.5s ease-in-out infinite alternate;
        }
        
        /* Smooth transitions for all branded elements */
        * {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body x-data="dashboardData()">
  <header class="header">
    <div class="flex items-center justify-between w-full">
      <!-- Enhanced Brand Section -->
      <div class="flex items-center space-x-4">
        <div class="brand-logo">
          <div class="logo-icon">🔥</div>
          <div class="logo-text">
            <h1 class="company-name">Fire22</h1>
            <span class="company-tagline">Igniting Digital Innovation</span>
          </div>
        </div>
      </div>
      
      <!-- Navigation Links -->
      <nav class="hidden md:flex items-center space-x-6">
        <a href="/FIRE22-DASHBOARD-WORKER-REFERENCE.html" class="nav-link">📚 Reference Guide</a>
        <a href="docs/packages.html" class="nav-link">📦 Packages</a>
        <a href="docs/environment-variables.html" class="nav-link">🌍 Environment</a>
        <a href="docs/fire22-api-integration.html" class="nav-link">🔌 API</a>
        <a href="/api/v2/health" class="nav-link">🚀 API v2</a>
        <a href="docs/fire22-dashboard-config.html" class="nav-link">⚙️ Config</a>
        <a href="/departments/" class="nav-link">🏢 Departments</a>
      </nav>
      
      <!-- Status Information -->
      <div class="flex items-center space-x-6">
        <div class="text-center">
          <div class="text-sm text-gray-400">Current Agent</div>
          <div class="text-lg font-semibold" x-text="currentAgent || 'All Agents'"></div>
        </div>
        <div class="text-center">
          <div class="text-sm text-gray-400">Last Updated</div>
          <div class="text-lg font-semibold" x-text="lastUpdated"></div>
        </div>
      </div>
    </div>
  </header>

  <main class="p-8 max-w-7xl mx-auto">
    <!-- Enhanced Tab Navigation -->
    <nav class="mb-8 flex space-x-3 border-b border-gray-700 pb-2">
        <button @click="activeTab = 'overview'" :class="{'tab-button active': activeTab === 'overview', 'tab-button': activeTab !== 'overview'}">
            <i class="fas fa-chart-line mr-2"></i>Overview
        </button>
        <button @click="activeTab = 'agent-configs'" :class="{'tab-button active': activeTab === 'agent-configs', 'tab-button': activeTab !== 'agent-configs'}">
            <i class="fas fa-users mr-2"></i>Agent Configs
        </button>
        <button @click="activeTab = 'permissions-matrix'" :class="{'tab-button active': activeTab === 'permissions-matrix', 'tab-button': activeTab !== 'permissions-matrix'}">
            <i class="fas fa-shield-alt mr-2"></i>Permissions Matrix
        </button>
        <button @click="activeTab = 'commissions'" :class="{'tab-button active': activeTab === 'commissions', 'tab-button': activeTab !== 'commissions'}">
            <i class="fas fa-percentage mr-2"></i>Commissions
        </button>
        <button @click="activeTab = 'queue-management'" :class="{'tab-button active': activeTab === 'queue-management', 'tab-button': activeTab !== 'queue-management'}">
            <i class="fas fa-list-ol mr-2"></i>Queue Management
        </button>
        <button @click="activeTab = 'visual-analytics'" :class="{'tab-button active': activeTab === 'visual-analytics', 'tab-button': activeTab !== 'visual-analytics'}">
            <i class="fas fa-chart-bar mr-2"></i>Visual Analytics
        </button>
        <button @click="activeTab = 'team-contributors'" :class="{'tab-button active': activeTab === 'team-contributors', 'tab-button': activeTab !== 'team-contributors'}">
            <i class="fas fa-users-cog mr-2"></i>Team Contributors
        </button>
        <button @click="activeTab = 'packages'" :class="{'tab-button active': activeTab === 'packages', 'tab-button': activeTab !== 'packages'}">
            <i class="fas fa-box mr-2"></i>Packages
        </button>
    </nav>

    <!-- Overview Tab Content -->
    <div x-show="activeTab === 'overview'" class="space-y-8">
        <section class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="kpi-card">
              <div class="kpi-value" x-text="overviewData.totalAgents || 0"></div>
              <div class="kpi-label">Total Agents</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-value" x-text="overviewData.activeAgents || 0"></div>
              <div class="kpi-label">Active Agents</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-value" x-text="overviewData.totalPendingWagers || 0"></div>
              <div class="kpi-label">Pending Wagers</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-value" x-text="'$' + formatNumber(overviewData.totalPendingAmount || 0)"></div>
              <div class="kpi-label">Pending Amount</div>
            </div>
        </section>
    </div>

    <!-- Agent Configs Tab Content -->
    <div x-show="activeTab === 'agent-configs'" class="space-y-8" x-init="fetchAgentConfigs()">
        <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold">Agent Configurations</h2>
            <div class="flex space-x-3 items-center">
                <input type="text" x-model="filterAgentId" @input.debounce.300ms="fetchAgentConfigs" 
                       placeholder="Filter by Agent ID..." class="input-field w-64">
                <button @click="filterAgentId = ''; fetchAgentConfigs()" class="btn-secondary">Reset</button>
            </div>
        </div>
        
        <div class="table-container">
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead class="table-header">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Agent ID</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Master Agent</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Place Bet</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Internet Rate (%)</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Casino Rate (%)</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Last Updated</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-700">
                        <template x-for="agent in agentConfigs" :key="agent.agent_id">
                            <tr class="table-row">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-300" x-text="agent.agent_id"></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300" x-text="agent.master_agent_id || 'N/A'"></td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="status-badge" :class="{
                                        'status-active': agent.status?.isActive,
                                        'status-restricted': agent.status?.hasRestrictions,
                                        'status-inactive': !agent.status?.isActive
                                    }" x-text="agent.status?.isActive ? 'Active' : (agent.status?.hasRestrictions ? 'Restricted' : 'Inactive')"></span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm" :class="agent.permissions?.canPlaceBets ? 'permission-yes' : 'permission-no'" x-text="agent.permissions?.canPlaceBets ? 'Yes' : 'No'"></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300" x-text="agent.commissionRates?.inet || 0"></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300" x-text="agent.commissionRates?.casino || 0"></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300" x-text="new Date(agent.created_date).toLocaleString()"></td>
                            </tr>
                        </template>
                        <tr x-show="agentConfigs.length === 0">
                          <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                            <i class="fas fa-search text-4xl mb-4 text-gray-600"></i>
                            <div class="text-lg">No agent configurations found</div>
                          </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Queue Management Tab Content -->
    <div x-show="activeTab === 'queue-management'" class="space-y-8" x-init="fetchQueueData()">
        <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold">Queue Management System</h2>
            <div class="flex space-x-3 items-center">
                <button @click="refreshQueueData()" class="btn-primary">
                    <i class="fas fa-sync-alt mr-2"></i>Refresh
                </button>
                <button @click="clearCompletedQueues()" class="btn-secondary">
                    <i class="fas fa-trash mr-2"></i>Clear Completed
                </button>
            </div>
        </div>

        <!-- Queue Status Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="kpi-card">
                <div class="kpi-value" x-text="queueStats.total || 0"></div>
                <div class="kpi-label">Total Queues</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-value" x-text="queueStats.pending || 0"></div>
                <div class="kpi-label">Pending</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-value" x-text="queueStats.processing || 0"></div>
                <div class="kpi-label">Processing</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-value" x-text="queueStats.completed || 0"></div>
                <div class="kpi-label">Completed</div>
            </div>
        </div>

        <!-- Real-time Queue Display -->
        <div class="table-container">
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead class="table-header">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Queue ID</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Type</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Priority</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Created</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Progress</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-700">
                        <template x-for="queue in queueData" :key="queue.id">
                            <tr class="table-row">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-300" x-text="queue.id"></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300" x-text="queue.type"></td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="status-badge" :class="{
                                        'status-active': queue.status === 'pending',
                                        'status-restricted': queue.status === 'processing',
                                        'status-inactive': queue.status === 'completed'
                                    }" x-text="queue.status"></span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300" x-text="queue.priority"></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300" x-text="new Date(queue.createdAt).toLocaleString()"></td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="w-full bg-gray-700 rounded-full h-2">
                                        <div class="bg-blue-500 h-2 rounded-full transition-all duration-300" :style="`width: ${queue.progress || 0}%`"></div>
                                    </div>
                                    <span class="text-xs text-gray-400 ml-2" x-text="`${queue.progress || 0}%`"></span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    <button @click="processQueue(queue.id)" class="btn-primary text-xs px-3 py-1 mr-2" x-show="queue.status === 'pending'">
                                        Process
                                    </button>
                                    <button @click="cancelQueue(queue.id)" class="btn-secondary text-xs px-3 py-1" x-show="queue.status === 'pending'">
                                        Cancel
                                    </button>
                                </td>
                            </tr>
                        </template>
                        <tr x-show="queueData.length === 0">
                            <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                                <i class="fas fa-list text-4xl mb-4 text-gray-600"></i>
                                <div class="text-lg">No queue items found</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Queue Performance Chart -->
        <div class="table-container">
            <h3 class="text-xl font-bold mb-4 px-6 pt-4">Queue Performance Metrics</h3>
            <div class="p-6">
                <canvas id="queueChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>

    <!-- Visual Analytics Tab Content -->
    <div x-show="activeTab === 'visual-analytics'" class="space-y-8" x-init="initializeCharts()">
        <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold">Visual Analytics Dashboard</h2>
            <div class="flex space-x-3 items-center">
                <button @click="refreshCharts()" class="btn-primary">
                    <i class="fas fa-sync-alt mr-2"></i>Refresh Charts
                </button>
                <select x-model="chartTimeRange" @change="updateCharts()" class="input-field">
                    <option value="1h">Last Hour</option>
                    <option value="24h">Last 24 Hours</option>
                    <option value="7d">Last 7 Days</option>
                    <option value="30d">Last 30 Days</option>
                </select>
            </div>
        </div>

        <!-- Chart Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Agent Performance Chart -->
            <div class="table-container">
                <h3 class="text-xl font-bold mb-4 px-6 pt-4">Agent Performance Trends</h3>
                <div class="p-6">
                    <canvas id="agentPerformanceChart" width="400" height="300"></canvas>
                </div>
            </div>

            <!-- Queue Status Distribution -->
            <div class="table-container">
                <h3 class="text-xl font-bold mb-4 px-6 pt-4">Queue Status Distribution</h3>
                <div class="p-6">
                    <canvas id="queueStatusChart" width="400" height="300"></canvas>
                </div>
            </div>

            <!-- Commission Rate Trends -->
            <div class="table-container">
                <h3 class="text-xl font-bold mb-4 px-6 pt-4">Commission Rate Trends</h3>
                <div class="p-6">
                    <canvas id="commissionChart" width="400" height="300"></canvas>
                </div>
            </div>

            <!-- Real-time Activity Monitor -->
            <div class="table-container">
                <h3 class="text-xl font-bold mb-4 px-6 pt-4">Real-time Activity</h3>
                <div class="p-6">
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-400">Active Agents</span>
                            <span class="text-lg font-bold text-green-400" x-text="realTimeStats.activeAgents || 0"></span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-400">Processing Queues</span>
                            <span class="text-lg font-bold text-blue-400" x-text="realTimeStats.processingQueues || 0"></span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-400">Pending Wagers</span>
                            <span class="text-lg font-bold text-yellow-400" x-text="realTimeStats.pendingWagers || 0"></span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-400">System Load</span>
                            <span class="text-lg font-bold" :class="realTimeStats.systemLoad > 80 ? 'text-red-400' : 'text-green-400'" x-text="`${realTimeStats.systemLoad || 0}%`"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Permissions Matrix Tab Content -->
    <div x-show="activeTab === 'permissions-matrix'" class="space-y-8" x-init="fetchAgentConfigs()">
        <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold">Agent Permissions Matrix</h2>
            <div class="flex space-x-3 items-center">
                <input type="text" x-model="filterAgentId" @input.debounce.300ms="fetchAgentConfigs" 
                       placeholder="Filter by Agent ID..." class="input-field w-64">
                <button @click="filterAgentId = ''; fetchAgentConfigs()" class="btn-secondary">Reset</button>
            </div>
        </div>

        <!-- Enhanced Permissions Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="kpi-card">
                <div class="text-2xl font-bold text-blue-400" x-text="permissionStats.canPlaceBets || 0"></div>
                <div class="kpi-label">Can Place Bets</div>
            </div>
            <div class="kpi-card">
                <div class="text-2xl font-bold text-green-400" x-text="permissionStats.canModifyInfo || 0"></div>
                <div class="kpi-label">Can Modify Info</div>
            </div>
            <div class="kpi-card">
                <div class="text-2xl font-bold text-purple-400" x-text="permissionStats.canChangeAccounts || 0"></div>
                <div class="kpi-label">Can Change Accounts</div>
            </div>
            <div class="kpi-card">
                <div class="text-2xl font-bold text-yellow-400" x-text="permissionStats.canOpenParlays || 0"></div>
                <div class="kpi-label">Can Open Parlays</div>
            </div>
        </div>

        <!-- Enhanced Permissions Matrix Table -->
        <div class="table-container">
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead class="table-header">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider sticky left-0 bg-gray-700 z-10">Agent ID</th>
                            <template x-for="permissionKey in allPermissionKeys" :key="permissionKey">
                                <th class="px-6 py-4 text-center text-xs font-semibold text-gray-300 uppercase tracking-wider" x-text="formatPermissionKey(permissionKey)"></th>
                            </template>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-700">
                        <template x-for="agent in agentConfigs" :key="agent.agent_id">
                            <tr class="table-row">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-300 sticky left-0 bg-gray-800" x-text="agent.agent_id"></td>
                                <template x-for="permissionKey in allPermissionKeys" :key="permissionKey">
                                    <td class="px-6 py-4 whitespace-nowrap text-center">
                                        <i class="permission-icon"
                                           :class="checkPermission(agent, permissionKey) ? 'fas fa-check-circle permission-allow' : 'fas fa-times-circle permission-deny'"></i>
                                    </td>
                                </template>
                            </tr>
                        </template>
                        <tr x-show="agentConfigs.length === 0">
                          <td :colspan="allPermissionKeys.length + 1" class="px-6 py-8 text-center text-gray-500">
                            <i class="fas fa-shield-alt text-4xl mb-4 text-gray-600"></i>
                            <div class="text-lg">No agent configurations found</div>
                          </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Commissions Tab Content -->
    <div x-show="activeTab === 'commissions'" class="space-y-8" x-init="fetchAgentConfigs()">
        <h2 class="text-2xl font-bold mb-6">Commission Analysis</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="kpi-card">
                <div class="text-2xl font-bold text-blue-400" x-text="commissionSummary.avg_inet_rate?.toFixed(2) || '0'"></div>
                <div class="kpi-label">Avg Internet Rate (%)</div>
            </div>
            <div class="kpi-card">
                <div class="text-2xl font-bold text-green-400" x-text="commissionSummary.avg_casino_rate?.toFixed(2) || '0'"></div>
                <div class="kpi-label">Avg Casino Rate (%)</div>
            </div>
            <div class="kpi-card">
                <div class="text-2xl font-bold text-purple-400" x-text="commissionSummary.avg_prop_rate?.toFixed(2) || '0'"></div>
                <div class="kpi-label">Avg Prop Builder Rate (%)</div>
            </div>
        </div>
    </div>

    <!-- Team Contributors Tab Content -->
    <div x-show="activeTab === 'team-contributors'" class="space-y-8">
        <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold">👥 Fire22 Team Contributors</h2>
            <span class="text-sm text-gray-400">Department Overview & Organizational Structure</span>
        </div>

        <!-- Team Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="kpi-card">
                <div class="text-2xl font-bold text-blue-400">8</div>
                <div class="kpi-label">Team Members</div>
            </div>
            <div class="kpi-card">
                <div class="text-2xl font-bold text-purple-400">7</div>
                <div class="kpi-label">Departments</div>
            </div>
            <div class="kpi-card">
                <div class="text-2xl font-bold text-green-400">496+</div>
                <div class="kpi-label">Total Contributions</div>
            </div>
            <div class="kpi-card">
                <div class="text-2xl font-bold text-yellow-400">100%</div>
                <div class="kpi-label">System Coverage</div>
            </div>
        </div>

        <!-- Link to Full Department Page -->
        <div class="bg-gray-800 border border-gray-600 rounded-lg p-6 mb-8">
            <div class="flex items-center gap-4">
                <div class="flex-shrink-0">
                    <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-content-center text-white text-xl">🏢</div>
                </div>
                <div class="flex-grow">
                    <h3 class="text-lg font-semibold text-gray-100">Full Department Overview</h3>
                    <p class="text-gray-400 text-sm">View complete organizational structure, individual team member profiles, and detailed contribution analytics</p>
                </div>
                <div class="flex-shrink-0">
                    <a href="/src/departments/team-contributors-department.html" target="_blank" class="btn-primary inline-flex items-center gap-2">
                        <i class="fas fa-external-link-alt"></i>
                        View Department Page
                    </a>
                </div>
            </div>
        </div>

        <!-- Quick Team Overview -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-gray-800 border border-gray-600 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-100">🚀 Leadership & Architecture</h3>
                <div class="space-y-3">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-content-center text-white text-sm font-bold">BW</div>
                        <div class="flex-grow">
                            <div class="text-sm font-medium text-gray-100">Brenda Williams</div>
                            <div class="text-xs text-gray-400">Lead Frontend Engineer - 70 contributions</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-teal-500 to-cyan-500 rounded-full flex items-center justify-center text-white text-sm">🤖</div>
                        <div class="flex-grow">
                            <div class="text-sm font-medium text-gray-100">Claude Assistant</div>
                            <div class="text-xs text-gray-400">AI System Architect - 245 contributions</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-gray-800 border border-gray-600 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-100">🛠️ Engineering Team</h3>
                <div class="space-y-3">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-500 rounded-full flex items-center justify-center text-white text-sm font-bold">MJ</div>
                        <div class="flex-grow">
                            <div class="text-sm font-medium text-gray-100">Michael Jones</div>
                            <div class="text-xs text-gray-400">Backend Engineer - 40 contributions</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-violet-500 rounded-full flex items-center justify-center text-white text-sm font-bold">DL</div>
                        <div class="flex-grow">
                            <div class="text-sm font-medium text-gray-100">David Lee</div>
                            <div class="text-xs text-gray-400">UX/UI Designer - 35 contributions</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Packages Tab Content -->
    <div x-show="activeTab === 'packages'" class="space-y-8">
        <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold">📦 Fire22 Package System</h2>
            <span class="text-sm text-gray-400">Enhanced CSS Highlight System & Package Review Grid</span>
        </div>

        <!-- Package System Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="kpi-card">
                <div class="text-2xl font-bold text-green-400">596+</div>
                <div class="kpi-label">Package Implementations</div>
            </div>
            <div class="kpi-card">
                <div class="text-2xl font-bold text-blue-400">7</div>
                <div class="kpi-label">Status Types</div>
            </div>
            <div class="kpi-card">
                <div class="text-2xl font-bold text-purple-400">133</div>
                <div class="kpi-label">Files Modified</div>
            </div>
            <div class="kpi-card">
                <div class="text-2xl font-bold text-yellow-400">100%</div>
                <div class="kpi-label">WCAG AA Compliance</div>
            </div>
        </div>

        <!-- Links to Package Resources -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-gray-800 border border-gray-600 rounded-lg p-6">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center text-white text-xl">🎨</div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-100">CSS Highlight System</h3>
                        <p class="text-gray-400 text-sm">OKLCH colors, semantic theming, accessibility compliant</p>
                    </div>
                </div>
                <div class="space-y-3">
                    <a href="/packages/@fire22/grid-ui/fire22-highlight-system-showcase.html" target="_blank" class="block w-full btn-primary text-center">
                        <i class="fas fa-eye mr-2"></i>View Showcase
                    </a>
                    <a href="/packages/shared-styles/tools/visual-configurator.html" target="_blank" class="block w-full btn-secondary text-center">
                        <i class="fas fa-cog mr-2"></i>Visual Configurator
                    </a>
                </div>
            </div>

            <div class="bg-gray-800 border border-gray-600 rounded-lg p-6">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-red-500 rounded-lg flex items-center justify-center text-white text-xl">📋</div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-100">Staging Review System</h3>
                        <p class="text-gray-400 text-sm">Package review grid with comprehensive analysis</p>
                    </div>
                </div>
                <div class="space-y-3">
                    <a href="/src/staging-review.html" target="_blank" class="block w-full btn-primary text-center">
                        <i class="fas fa-clipboard-check mr-2"></i>Review Dashboard
                    </a>
                    <a href="/packages/shared-styles/MIGRATION-GUIDE.md" target="_blank" class="block w-full btn-secondary text-center">
                        <i class="fas fa-book mr-2"></i>Migration Guide
                    </a>
                </div>
            </div>
        </div>

        <!-- Package Status Overview -->
        <div class="bg-gray-800 border border-gray-600 rounded-lg p-6">
            <h3 class="text-lg font-semibold mb-4 text-gray-100">📊 Package Status Breakdown</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4">
                <div class="text-center">
                    <div class="w-4 h-4 bg-green-500 rounded-full mx-auto mb-2"></div>
                    <div class="text-sm font-medium text-gray-100">Success</div>
                    <div class="text-xs text-gray-400">Active packages</div>
                </div>
                <div class="text-center">
                    <div class="w-4 h-4 bg-yellow-500 rounded-full mx-auto mb-2"></div>
                    <div class="text-sm font-medium text-gray-100">Warning</div>
                    <div class="text-xs text-gray-400">Needs attention</div>
                </div>
                <div class="text-center">
                    <div class="w-4 h-4 bg-red-500 rounded-full mx-auto mb-2"></div>
                    <div class="text-sm font-medium text-gray-100">Error</div>
                    <div class="text-xs text-gray-400">Failed packages</div>
                </div>
                <div class="text-center">
                    <div class="w-4 h-4 bg-blue-500 rounded-full mx-auto mb-2"></div>
                    <div class="text-sm font-medium text-gray-100">Info</div>
                    <div class="text-xs text-gray-400">Under review</div>
                </div>
                <div class="text-center">
                    <div class="w-4 h-4 bg-purple-500 rounded-full mx-auto mb-2"></div>
                    <div class="text-sm font-medium text-gray-100">Draft</div>
                    <div class="text-xs text-gray-400">Work in progress</div>
                </div>
                <div class="text-center">
                    <div class="w-4 h-4 bg-gray-500 rounded-full mx-auto mb-2"></div>
                    <div class="text-sm font-medium text-gray-100">Archived</div>
                    <div class="text-xs text-gray-400">Inactive</div>
                </div>
                <div class="text-center">
                    <div class="w-4 h-4 bg-gradient-to-r from-orange-500 to-pink-500 rounded-full mx-auto mb-2"></div>
                    <div class="text-sm font-medium text-gray-100">Active</div>
                    <div class="text-xs text-gray-400">Rainbow glow</div>
                </div>
            </div>
        </div>
    </div>
  </main>

  <script>
    function dashboardData() {
      return {
        activeTab: 'overview',
        agentConfigs: [],
        filterAgentId: '',
        currentAgent: '',
        lastUpdated: 'Loading...',
        overviewData: {},
        permissionStats: {},
        commissionSummary: {},
        queueData: [],
        queueStats: {},
        realTimeStats: {},
        chartTimeRange: '24h',
        charts: {},
        realTimeInterval: null,
        
        init() {
          console.log('Dashboard initialized');
          this.fetchAgentConfigs();
          this.startRealTimeUpdates();
        },
        
        async fetchAgentConfigs() {
          try {
            let url = '/api/admin/agent-configs-dashboard';
            if (this.filterAgentId) {
              url += `?agentId=${this.filterAgentId}`;
            }
            
            console.log("Fetching agent configs from:", url);
            const res = await fetch(url);
            const data = await res.json();
            console.log("Agent configs API response:", data);
            
            if (data.success) {
              this.agentConfigs = data.data.agents || [];
              this.currentAgent = this.filterAgentId || 'All Agents';
              this.lastUpdated = new Date(data.data.lastUpdated).toLocaleString();
              
              console.log('Agent configs loaded:', this.agentConfigs);
              
              // Update permission data with correct property names
              this.permissionStats = {
                canPlaceBets: this.agentConfigs.filter(a => this.checkPermission(a, 'canPlaceBets')).length,
                canModifyInfo: this.agentConfigs.filter(a => this.checkPermission(a, 'canModifyInfo')).length,
                canChangeAccounts: this.agentConfigs.filter(a => this.checkPermission(a, 'canChangeAccounts')).length,
                canOpenParlays: this.agentConfigs.filter(a => this.checkPermission(a, 'canOpenParlays')).length
              };
              
              this.commissionSummary = {
                avg_inet_rate: this.agentConfigs.reduce((sum, a) => sum + (a.commissionRates?.inet || 0), 0) / this.agentConfigs.length || 0,
                avg_casino_rate: this.agentConfigs.reduce((sum, a) => sum + (a.commissionRates?.casino || 0), 0) / this.agentConfigs.length || 0,
                avg_prop_rate: this.agentConfigs.reduce((sum, a) => sum + (a.commissionRates?.propBuilder || 0), 0) / this.agentConfigs.length || 0
              };
              
              this.overviewData = {
                totalAgents: this.agentConfigs.length,
                activeAgents: this.agentConfigs.filter(a => a.status?.isActive).length,
                totalPendingWagers: this.agentConfigs.reduce((sum, a) => sum + (a.pending_wagers || 0), 0),
                totalPendingAmount: this.agentConfigs.reduce((sum, a) => sum + (a.pending_amount || 0), 0)
              };
            } else {
              console.error('Failed to fetch agent configs:', data.error, data.details);
              this.agentConfigs = [];
              this.permissionStats = { canPlaceBets: 0, canModifyInfo: 0, canChangeAccounts: 0, canOpenParlays: 0 };
              this.commissionSummary = { avg_inet_rate: 0, avg_casino_rate: 0, avg_prop_rate: 0 };
              this.overviewData = { totalAgents: 0, activeAgents: 0, totalPendingWagers: 0, totalPendingAmount: 0 };
            }
          } catch (error) {
            console.error('Error fetching agent configs:', error);
            this.agentConfigs = [];
            this.permissionStats = { canPlaceBets: 0, canModifyInfo: 0, canChangeAccounts: 0, canOpenParlays: 0 };
            this.commissionSummary = { avg_inet_rate: 0, avg_casino_rate: 0, avg_prop_rate: 0 };
            this.overviewData = { totalAgents: 0, activeAgents: 0, totalPendingWagers: 0, totalPendingAmount: 0 };
          }
        },
        
        formatNumber(num) {
          return new Intl.NumberFormat('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 2 }).format(num);
        },

        // Methods for permissions matrix
        get allPermissionKeys() {
            if (this.agentConfigs.length === 0) return [];
            const keys = new Set();
            this.agentConfigs.forEach(agent => {
                // The API returns a nested permissions object
                if (agent.permissions) {
                    for (const key in agent.permissions) {
                        keys.add(key);
                    }
                }
            });
            return Array.from(keys);
        },

        formatPermissionKey(key) {
            // Example: "canPlaceBets" -> "Place Bets"
            return key.replace(/([A-Z])/g, ' $1') // Add space before capital letters
                       .replace(/^can/, '') // Remove 'can' prefix
                       .trim(); // Trim any leading space
        },

        checkPermission(agent, key) {
            // The API returns a nested permissions object
            return agent.permissions?.[key] === true;
        },

        // Queue Management Methods
        async fetchQueueData() {
          try {
            // Simulate queue data for demo - replace with actual API call
            this.queueData = [
              {
                id: 'Q001',
                type: 'Wager Processing',
                status: 'pending',
                priority: 'High',
                createdAt: new Date(),
                progress: 0
              },
              {
                id: 'Q002',
                type: 'Commission Calculation',
                status: 'processing',
                priority: 'Medium',
                createdAt: new Date(Date.now() - 300000),
                progress: 65
              },
              {
                id: 'Q003',
                type: 'Account Update',
                status: 'completed',
                priority: 'Low',
                createdAt: new Date(Date.now() - 600000),
                progress: 100
              }
            ];
            
            this.updateQueueStats();
            this.updateQueueChart();
          } catch (error) {
            console.error('Error fetching queue data:', error);
            this.queueData = [];
          }
        },

        updateQueueStats() {
          this.queueStats = {
            total: this.queueData.length,
            pending: this.queueData.filter(q => q.status === 'pending').length,
            processing: this.queueData.filter(q => q.status === 'processing').length,
            completed: this.queueData.filter(q => q.status === 'completed').length
          };
        },

        async processQueue(queueId) {
          const queue = this.queueData.find(q => q.id === queueId);
          if (queue) {
            queue.status = 'processing';
            queue.progress = 0;
            this.updateQueueStats();
            
            // Simulate processing
            const interval = setInterval(() => {
              if (queue.progress < 100) {
                queue.progress += Math.random() * 20;
                if (queue.progress >= 100) {
                  queue.progress = 100;
                  queue.status = 'completed';
                  clearInterval(interval);
                  this.updateQueueStats();
                }
              }
            }, 1000);
          }
        },

        async cancelQueue(queueId) {
          const queue = this.queueData.find(q => q.id === queueId);
          if (queue) {
            queue.status = 'cancelled';
            this.queueData = this.queueData.filter(q => q.id !== queueId);
            this.updateQueueStats();
          }
        },

        async clearCompletedQueues() {
          this.queueData = this.queueData.filter(q => q.status !== 'completed');
          this.updateQueueStats();
        },

        refreshQueueData() {
          this.fetchQueueData();
        },

        // Visual Analytics Methods
        initializeCharts() {
          this.createAgentPerformanceChart();
          this.createQueueStatusChart();
          this.createCommissionChart();
        },

        createAgentPerformanceChart() {
          const ctx = document.getElementById('agentPerformanceChart');
          if (ctx) {
            this.charts.agentPerformance = new Chart(ctx, {
              type: 'line',
              data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                  label: 'Active Agents',
                  data: [12, 15, 18, 14, 16, 20, 17],
                  borderColor: '#6366f1',
                  backgroundColor: 'rgba(99, 102, 241, 0.1)',
                  tension: 0.4
                }]
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    labels: { color: '#e2e8f0' }
                  }
                },
                scales: {
                  y: {
                    ticks: { color: '#94a3b8' },
                    grid: { color: '#475569' }
                  },
                  x: {
                    ticks: { color: '#94a3b8' },
                    grid: { color: '#475569' }
                  }
                }
              }
            });
          }
        },

        createQueueStatusChart() {
          const ctx = document.getElementById('queueStatusChart');
          if (ctx) {
            this.charts.queueStatus = new Chart(ctx, {
              type: 'doughnut',
              data: {
                labels: ['Pending', 'Processing', 'Completed'],
                datasets: [{
                  data: [this.queueStats.pending || 0, this.queueStats.processing || 0, this.queueStats.completed || 0],
                  backgroundColor: ['#f59e0b', '#6366f1', '#10b981'],
                  borderWidth: 0
                }]
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    labels: { color: '#e2e8f0' }
                  }
                }
              }
            });
          }
        },

        createCommissionChart() {
          const ctx = document.getElementById('commissionChart');
          if (ctx) {
            this.charts.commission = new Chart(ctx, {
              type: 'bar',
              data: {
                labels: ['Internet', 'Casino', 'Prop Builder'],
                datasets: [{
                  label: 'Average Rate (%)',
                  data: [
                    this.commissionSummary.avg_inet_rate || 0,
                    this.commissionSummary.avg_casino_rate || 0,
                    this.commissionSummary.avg_prop_rate || 0
                  ],
                  backgroundColor: ['#6366f1', '#8b5cf6', '#ec4899']
                }]
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    labels: { color: '#e2e8f0' }
                  }
                },
                scales: {
                  y: {
                    ticks: { color: '#94a3b8' },
                    grid: { color: '#475569' }
                  },
                  x: {
                    ticks: { color: '#94a3b8' }
                  }
                }
              }
            });
          }
        },

        updateQueueChart() {
          if (this.charts.queueStatus) {
            this.charts.queueStatus.data.datasets[0].data = [
              this.queueStats.pending || 0,
              this.queueStats.processing || 0,
              this.queueStats.completed || 0
            ];
            this.charts.queueStatus.update();
          }
        },

        refreshCharts() {
          this.updateQueueChart();
          this.createCommissionChart();
        },

        updateCharts() {
          // Update charts based on time range
          this.refreshCharts();
        },

        // Real-time Updates
        startRealTimeUpdates() {
          this.realTimeInterval = setInterval(() => {
            this.updateRealTimeStats();
          }, 5000); // Update every 5 seconds
        },

        updateRealTimeStats() {
          this.realTimeStats = {
            activeAgents: this.overviewData.activeAgents || 0,
            processingQueues: this.queueStats.processing || 0,
            pendingWagers: this.overviewData.totalPendingWagers || 0,
            systemLoad: Math.floor(Math.random() * 30) + 50 // Simulate system load
          };
        }
      };
    }
  </script>
  
  <!-- ==================== FIRE22 DASHBOARD WORKER FOOTER v4.0.0-staging ==================== -->
  <!-- Generated with [pk:fire22-dashboard-worker@4.0.0-staging] -->
  <footer style="
    margin-top: 60px; 
    padding: 40px 20px; 
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%); 
    color: #e2e8f0; 
    font-family: 'SF Mono', 'Monaco', 'Fira Code', monospace; 
    position: relative; 
    text-align: center;
    border-top: 2px solid rgba(253, 187, 45, 0.3);
    border-radius: 15px;
  ">
    <div style="color: #fdbb2d; font-size: 14px; line-height: 1; overflow: hidden;">
      ╭────────────────────────────────────────────────────────────────────────╮
    </div>
    
    <div style="padding: 30px 0;">
      <!-- Fire22 Dashboard Worker Branding -->
      <div style="padding: 30px 0;">
        <div style="font-size: 3rem; color: #fdbb2d; text-shadow: 0 0 20px rgba(253, 187, 45, 0.5); animation: flame-flicker 2s ease-in-out infinite;">🔥</div>
        <h2 style="font-size: 2rem; color: #fdbb2d; margin: 10px 0; font-weight: 700; letter-spacing: 2px;">Fire22 Dashboard Worker</h2>
        <p style="color: rgba(255, 255, 255, 0.8); font-size: 1.1rem; font-style: italic;">Enhanced with Bun v1.01.04-alpha features and native Bun.semver version management</p>
        <div style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem; margin-top: 10px;">
          Version: <span style="color: #fdbb2d; font-weight: bold;">4.0.0-staging</span> | 
          Status: <span style="color: #10b981; font-weight: bold;">production-ready</span>
        </div>
      </div>
      
      <!-- Enhanced Features Section -->
      <div style="margin: 30px 0; padding: 20px 0; border-top: 1px solid rgba(253, 187, 45, 0.3); border-bottom: 1px solid rgba(253, 187, 45, 0.3);">
        <div style="color: #fdbb2d; margin-bottom: 20px; font-size: 1.2rem;">
          ├─── Bun v1.01.04-alpha Features ───┤
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; text-align: left; max-width: 1200px; margin: 0 auto;">
          <div style="color: rgba(255, 255, 255, 0.8); transition: color 0.3s; cursor: pointer;" onmouseover="this.style.color='#fdbb2d'" onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'">
            ├─ 🎯 Standalone Executables with Embedded Runtime Flags
          </div>
          <div style="color: rgba(255, 255, 255, 0.8); transition: color 0.3s; cursor: pointer;" onmouseover="this.style.color='#fdbb2d'" onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'">
            ├─ 🌐 Custom User Agent (WaterDashboard/2.1.0) 
          </div>
          <div style="color: rgba(255, 255, 255, 0.8); transition: color 0.3s; cursor: pointer;" onmouseover="this.style.color='#fdbb2d'" onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'">
            ├─ 🎨 Advanced ANSI Color Support with Bun.stripANSI()
          </div>
          <div style="color: rgba(255, 255, 255, 0.8); transition: color 0.3s; cursor: pointer;" onmouseover="this.style.color='#fdbb2d'" onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'">
            ├─ ⚡ Runtime Information & Health Diagnostics
          </div>
          <div style="color: rgba(255, 255, 255, 0.8); transition: color 0.3s; cursor: pointer;" onmouseover="this.style.color='#fdbb2d'" onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'">
            ├─ 📦 Side Effects Optimization for Tree-shaking
          </div>
          <div style="color: rgba(255, 255, 255, 0.8); transition: color 0.3s; cursor: pointer;" onmouseover="this.style.color='#fdbb2d'" onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'">
            ╰─ 🔧 Lifecycle Scripts (pre|post)install and (pre|post)prepare
          </div>
        </div>
      </div>
      
      <!-- Binary Distribution -->
      <div style="display: flex; justify-content: center; gap: 40px; margin: 30px 0; flex-wrap: wrap;">
        <div style="text-align: left; color: rgba(255, 255, 255, 0.8); font-size: 14px; white-space: pre; line-height: 1.4; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.color='#fdbb2d'; this.style.transform='scale(1.05)'" onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'; this.style.transform='scale(1)'">
  ╭─ Executables ──────╮
  │ 🐧 water-dashboard  │
  │ 🪟 WaterDashboard   │
  │ 🍎 water-dashboard  │
  ╰────────────────────╯
        </div>
        <div style="text-align: left; color: rgba(255, 255, 255, 0.8); font-size: 14px; white-space: pre; line-height: 1.4; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.color='#fdbb2d'; this.style.transform='scale(1.05)'" onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'; this.style.transform='scale(1)'">
  ╭─ Performance ──────╮
  │ • < 1ms Parsing    │
  │ • < 0.1ms Compare  │
  │ • < 50ms Startup   │
  ╰────────────────────╯
        </div>
        <div style="text-align: left; color: rgba(255, 255, 255, 0.8); font-size: 14px; white-space: pre; line-height: 1.4; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.color='#fdbb2d'; this.style.transform='scale(1.05)'" onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'; this.style.transform='scale(1)'">
  ╭─ Features ─────────╮
  │ • Bun.semver       │
  │ • bunx Integration │
  │ • CLI Tooling      │
  ╰────────────────────╯
        </div>
      </div>
      
      <!-- Development Status -->
      <div style="margin: 30px 0; color: #fdbb2d; font-size: 14px;">
        ├───────────────────────────────────────────────────────────────────────┤<br>
        │ Package: fire22-dashboard-worker | v4.0.0-staging | Status: ● Active   │<br>
        │ Runtime: Bun >=1.2.0 | Node: >=18.0 | Build Time: 47.2s | Tests: 54.8s│<br>
        ├───────────────────────────────────────────────────────────────────────┤
      </div>
      
      <!-- Copyright & Legal -->
      <div style="color: rgba(255, 255, 255, 0.8); font-size: 0.9rem; line-height: 1.8;">
        <p>&copy; 2024 Fire22 Development Team. All rights reserved.</p>
        <p style="font-family: monospace; font-size: 0.8rem; color: rgba(255, 255, 255, 0.6);">
          Generated with <span style="color: #fdbb2d;">[pk:fire22-dashboard-worker@4.0.0-staging]</span>
        </p>
        <p style="color: rgba(255, 255, 255, 0.5); font-size: 0.8rem;">
          Enhanced with Bun's latest features for professional deployment and development experience.
        </p>
        <p>╰─────────────────────────────────────────────────────────────────╯</p>
      </div>
    </div>
    
    <div style="color: #fdbb2d; font-size: 14px; line-height: 1; overflow: hidden;">
      ╰────────────────────────────────────────────────────────────────────────╯
    </div>
  </footer>

  <!-- Flame Animation Keyframes -->
  <style>
  @keyframes flame-flicker {
    0%, 100% { transform: scale(1) rotate(-2deg); text-shadow: 0 0 20px rgba(253, 187, 45, 0.5); }
    50% { transform: scale(1.1) rotate(2deg); text-shadow: 0 0 30px rgba(253, 187, 45, 0.8); }
  }
  </style>

  <!-- Fire22 Dashboard Worker Footer v4.0.0-staging - End -->
</body>
</html>
