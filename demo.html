<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JWT Authentication with Cloudflare Integration</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #4361ee;
        --secondary: #3a0ca3;
        --success: #4cc9f0;
        --danger: #f72585;
        --warning: #fca311;
        --dark: #14213d;
        --light: #f8f9fa;
        --gray: #e5e5e5;
        --border-radius: 8px;
        --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        color: var(--dark);
        line-height: 1.6;
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
      }

      h1 {
        color: var(--primary);
        margin-bottom: 10px;
      }

      .subtitle {
        color: var(--secondary);
        font-weight: 300;
      }

      .dashboard {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
      }

      @media (max-width: 768px) {
        .dashboard {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        padding: 20px;
        transition: var(--transition);
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--gray);
      }

      .card-title {
        font-size: 1.2rem;
        color: var(--primary);
      }

      .card-icon {
        background: var(--primary);
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 10px 15px;
        border: 1px solid var(--gray);
        border-radius: var(--border-radius);
        font-size: 1rem;
        transition: var(--transition);
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
      }

      .btn {
        display: inline-block;
        padding: 10px 20px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        transition: var(--transition);
      }

      .btn:hover {
        background: var(--secondary);
      }

      .btn-block {
        display: block;
        width: 100%;
      }

      .btn-success {
        background: var(--success);
      }

      .btn-success:hover {
        background: #3aafd6;
      }

      .btn-danger {
        background: var(--danger);
      }

      .btn-danger:hover {
        background: #d11467;
      }

      .token-display {
        background: var(--light);
        padding: 15px;
        border-radius: var(--border-radius);
        margin-top: 15px;
        font-family: monospace;
        word-break: break-all;
        font-size: 0.9rem;
        max-height: 200px;
        overflow-y: auto;
      }

      .security-indicator {
        height: 10px;
        background: var(--gray);
        border-radius: 5px;
        margin: 15px 0;
        overflow: hidden;
      }

      .security-progress {
        height: 100%;
        width: 70%;
        background: var(--success);
        border-radius: 5px;
        transition: var(--transition);
      }

      .features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .feature {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        padding: 20px;
        text-align: center;
      }

      .feature-icon {
        font-size: 2.5rem;
        color: var(--primary);
        margin-bottom: 15px;
      }

      .feature-title {
        font-size: 1.2rem;
        margin-bottom: 10px;
      }

      .logs {
        background: var(--dark);
        color: white;
        padding: 20px;
        border-radius: var(--border-radius);
        margin-top: 30px;
        max-height: 200px;
        overflow-y: auto;
      }

      .log-entry {
        margin-bottom: 10px;
        font-family: monospace;
        font-size: 0.9rem;
        padding: 5px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .log-time {
        color: var(--success);
        margin-right: 10px;
      }

      .status-badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        margin-left: 10px;
      }

      .status-active {
        background: var(--success);
        color: white;
      }

      .status-inactive {
        background: var(--gray);
        color: var(--dark);
      }

      .tab-container {
        margin-top: 20px;
      }

      .tabs {
        display: flex;
        border-bottom: 1px solid var(--gray);
        margin-bottom: 20px;
      }

      .tab {
        padding: 10px 20px;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: var(--transition);
      }

      .tab.active {
        border-bottom-color: var(--primary);
        color: var(--primary);
        font-weight: 500;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .cloudflare-config {
        background: #f38025;
        color: white;
        padding: 15px;
        border-radius: var(--border-radius);
        margin-bottom: 20px;
      }

      .config-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      @media (max-width: 768px) {
        .config-grid {
          grid-template-columns: 1fr;
        }
      }

      .badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 500;
        margin-left: 10px;
      }

      .badge-success {
        background: var(--success);
        color: white;
      }

      .badge-warning {
        background: var(--warning);
        color: var(--dark);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>JWT Authentication with Cloudflare Integration</h1>
        <p class="subtitle">
          Secure token-based authentication with enhanced security features
        </p>
      </header>

      <div class="cloudflare-config">
        <h2>
          <i class="fab fa-cloudflare"></i> Cloudflare Worker Configuration
        </h2>
        <div class="config-grid">
          <div class="form-group">
            <label for="worker-url">Worker URL</label>
            <input
              type="text"
              id="worker-url"
              value="https://jwt-auth-worker.example.workers.dev"
            />
          </div>
          <div class="form-group">
            <label for="api-version">API Version</label>
            <select id="api-version">
              <option value="v1">v1</option>
              <option value="v2">v2</option>
            </select>
          </div>
        </div>
      </div>

      <div class="dashboard">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Token Generation</h2>
            <div class="card-icon">
              <i class="fas fa-key"></i>
            </div>
          </div>
          <div class="form-group">
            <label for="username">Username</label>
            <input
              type="text"
              id="username"
              placeholder="Enter username"
              value="admin"
            />
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input
              type="password"
              id="password"
              placeholder="Enter password"
              value="password123"
            />
          </div>
          <div class="form-group">
            <label for="token-expiry">Token Expiry</label>
            <select id="token-expiry">
              <option value="3600">1 Hour</option>
              <option value="86400">1 Day</option>
              <option value="604800">1 Week</option>
            </select>
          </div>
          <button class="btn btn-block" id="generate-btn">
            Generate Token
          </button>

          <div class="security-indicator">
            <div class="security-progress" id="security-progress"></div>
          </div>

          <div class="token-display" id="token-display">
            Token will appear here after generation...
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Token Verification</h2>
            <div class="card-icon">
              <i class="fas fa-shield-alt"></i>
            </div>
          </div>
          <div class="form-group">
            <label for="token-to-verify">JWT Token</label>
            <textarea
              id="token-to-verify"
              rows="4"
              placeholder="Paste token to verify"
            ></textarea>
          </div>
          <button class="btn btn-success btn-block" id="verify-btn">
            Verify Token
          </button>

          <div class="tab-container">
            <div class="tabs">
              <div class="tab active" data-tab="payload">Payload</div>
              <div class="tab" data-tab="headers">Headers</div>
              <div class="tab" data-tab="signature">Signature</div>
            </div>

            <div class="tab-content active" id="payload-tab">
              <div class="token-display">
                Token payload will be displayed here after verification
              </div>
            </div>

            <div class="tab-content" id="headers-tab">
              <div class="token-display">
                Token headers will be displayed here after verification
              </div>
            </div>

            <div class="tab-content" id="signature-tab">
              <div class="token-display">
                Token signature verification status will be displayed here
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="features">
        <div class="feature">
          <div class="feature-icon">
            <i class="fas fa-bolt"></i>
          </div>
          <h3 class="feature-title">High Performance</h3>
          <p>Optimized token processing with minimal overhead</p>
        </div>

        <div class="feature">
          <div class="feature-icon">
            <i class="fas fa-lock"></i>
          </div>
          <h3 class="feature-title">Enhanced Security</h3>
          <p>Secure token storage and transmission best practices</p>
        </div>

        <div class="feature">
          <div class="feature-icon">
            <i class="fab fa-cloudflare"></i>
          </div>
          <h3 class="feature-title">Cloudflare Integration</h3>
          <p>Seamless integration with Cloudflare Workers</p>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Security Configuration</h2>
          <div class="card-icon">
            <i class="fas fa-cogs"></i>
          </div>
        </div>

        <div class="form-group">
          <label for="cookie-settings">Token Storage Method</label>
          <select id="cookie-settings">
            <option value="httpOnly">HttpOnly Cookie (Recommended)</option>
            <option value="sessionStorage">Session Storage</option>
            <option value="localStorage">Local Storage</option>
            <option value="memory">In-Memory Storage</option>
          </select>
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" id="https-only" checked />
            HTTPS Only (Secure cookies)
          </label>
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" id="same-site" checked />
            SameSite Strict Mode
          </label>
        </div>

        <div class="form-group">
          <label for="rate-limiting">Rate Limiting</label>
          <select id="rate-limiting">
            <option value="strict">Strict (5 requests/min)</option>
            <option value="moderate" selected>
              Moderate (10 requests/min)
            </option>
            <option value="lenient">Lenient (20 requests/min)</option>
          </select>
        </div>

        <button class="btn btn-block" id="save-config">
          Save Configuration
        </button>
      </div>

      <div class="logs">
        <div class="log-entry">
          <span class="log-time">12:30:45</span> System initialized
        </div>
        <div class="log-entry">
          <span class="log-time">12:31:02</span> Security policies loaded
        </div>
        <div class="log-entry">
          <span class="log-time">12:31:15</span> Cloudflare Worker configured
        </div>
        <div class="log-entry">
          <span class="log-time">12:31:28</span> Ready to generate tokens
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // DOM Elements
        const generateBtn = document.getElementById("generate-btn");
        const verifyBtn = document.getElementById("verify-btn");
        const tokenDisplay = document.getElementById("token-display");
        const securityProgress = document.getElementById("security-progress");
        const tabs = document.querySelectorAll(".tab");
        const tabContents = document.querySelectorAll(".tab-content");

        // Security Configuration
        const securityConfig = {
          storageMethod: "httpOnly",
          httpsOnly: true,
          sameSite: true,
          rateLimiting: "moderate",
        };

        // API Service
        class APIService {
          constructor(baseURL) {
            this.baseURL = baseURL;
            this.token = null;
            this.defaultHeaders = {
              "Content-Type": "application/json",
              "X-API-Version": "v1",
              "User-Agent": "JWT-Auth-Demo/2.1.0",
              "X-Client-ID": this.generateClientId(),
            };
          }

          generateClientId() {
            return "client_" + Math.random().toString(36).substr(2, 9);
          }

          setAuthToken(token) {
            this.token = token;
            // Store in sessionStorage for persistence
            sessionStorage.setItem("jwt_token", token);
          }

          getAuthHeaders() {
            const headers = { ...this.defaultHeaders };

            if (this.token) {
              headers["Authorization"] = `Bearer ${this.token}`;
            }

            // Add CSRF token
            headers["X-CSRF-Token"] =
              document.querySelector('meta[name="csrf-token"]')?.content || "";

            return headers;
          }

          async request(endpoint, options = {}) {
            const url = `${this.baseURL}${endpoint}`;
            const config = {
              ...options,
              headers: {
                ...this.getAuthHeaders(),
                ...options.headers,
              },
              credentials: "include", // Include cookies
            };

            try {
              const response = await fetch(url, config);

              // Auto-refresh token if expired
              if (response.status === 401) {
                const refreshed = await this.refreshToken();
                if (refreshed) {
                  config.headers["Authorization"] = `Bearer ${this.token}`;
                  return fetch(url, config);
                }
              }

              return response;
            } catch (error) {
              console.error("API Request failed:", error);
              throw error;
            }
          }

          async login(credentials) {
            const response = await this.request("/api/v1/auth/login", {
              method: "POST",
              body: JSON.stringify(credentials),
            });

            if (response.ok) {
              // Get token from response or set-cookie
              const data = await response.json();
              if (data.token) this.setAuthToken(data.token);
            }

            return response;
          }

          async getToken() {
            const response = await this.request("/api/v1/token", {
              method: "POST",
              body: JSON.stringify({ grant_type: "password" }),
            });

            if (response.ok) {
              const data = await response.json();
              this.setAuthToken(data.access_token);
              return data;
            }

            return response;
          }

          async refreshToken() {
            const refreshToken = sessionStorage.getItem("refresh_token");
            if (!refreshToken) return false;

            const response = await this.request("/api/v1/token/refresh", {
              method: "POST",
              body: JSON.stringify({ refresh_token: refreshToken }),
            });

            if (response.ok) {
              const data = await response.json();
              this.setAuthToken(data.access_token);
              sessionStorage.setItem("refresh_token", data.refresh_token);
              return true;
            }

            return false;
          }

          async verifyToken() {
            return this.request("/api/v1/verify", {
              method: "GET",
            });
          }

          async revokeToken() {
            return this.request("/api/v1/token/revoke", {
              method: "POST",
            });
          }

          async getProtectedResource(endpoint) {
            return this.request(endpoint, {
              method: "GET",
              headers: {
                Accept: "application/json",
              },
            });
          }
        }

        // Initialize API service
        const workerUrl = document.getElementById("worker-url").value;
        const api = new APIService(workerUrl);

        // Update security indicator
        function updateSecurityIndicator() {
          let securityLevel = 70; // Base level

          if (securityConfig.httpsOnly) securityLevel += 10;
          if (securityConfig.sameSite) securityLevel += 10;
          if (securityConfig.storageMethod === "httpOnly") securityLevel += 10;

          securityProgress.style.width = `${securityLevel}%`;

          if (securityLevel >= 90) {
            securityProgress.style.background = "#4cc9f0";
          } else if (securityLevel >= 70) {
            securityProgress.style.background = "#4361ee";
          } else {
            securityProgress.style.background = "#fca311";
          }
        }

        // Generate a mock JWT token
        function generateToken(username, expiry) {
          const header = {
            alg: "HS256",
            typ: "JWT",
          };

          const payload = {
            sub: "1234567890",
            username: username,
            iat: Math.floor(Date.now() / 1000),
            exp: Math.floor(Date.now() / 1000) + parseInt(expiry),
            ver: "v1",
          };

          // In a real implementation, this would be a valid signature
          const signature = "s1gnatur3s3cr3t";

          const encodedHeader = btoa(JSON.stringify(header));
          const encodedPayload = btoa(JSON.stringify(payload));

          return `${encodedHeader}.${encodedPayload}.${signature}`;
        }

        // Verify a mock JWT token
        function verifyToken(token) {
          try {
            const parts = token.split(".");
            if (parts.length !== 3) {
              return { valid: false, reason: "Invalid token format" };
            }

            const payload = JSON.parse(atob(parts[1]));
            const currentTime = Math.floor(Date.now() / 1000);

            if (payload.exp < currentTime) {
              return { valid: false, reason: "Token expired" };
            }

            return {
              valid: true,
              payload: payload,
              headers: JSON.parse(atob(parts[0])),
              signature: parts[2],
            };
          } catch (e) {
            return { valid: false, reason: "Invalid token" };
          }
        }

        // Event Listeners
        generateBtn.addEventListener("click", function () {
          const username = document.getElementById("username").value;
          const expiry = document.getElementById("token-expiry").value;

          if (!username) {
            alert("Please enter a username");
            return;
          }

          const token = generateToken(username, expiry);
          tokenDisplay.textContent = token;

          // Add log entry
          const logContainer = document.querySelector(".logs");
          const time = new Date().toLocaleTimeString();
          logContainer.innerHTML += `<div class="log-entry"><span class="log-time">${time}</span> Generated new token for user: ${username}</div>`;
          logContainer.scrollTop = logContainer.scrollHeight;

          // Simulate API call
          api
            .login({
              username,
              password: document.getElementById("password").value,
            })
            .then((response) => {
              if (response.ok) {
                logContainer.innerHTML += `<div class="log-entry"><span class="log-time">${new Date().toLocaleTimeString()}</span> Cloudflare Worker: Login successful</div>`;
              } else {
                logContainer.innerHTML += `<div class="log-entry"><span class="log-time">${new Date().toLocaleTimeString()}</span> Cloudflare Worker: Login failed</div>`;
              }
              logContainer.scrollTop = logContainer.scrollHeight;
            });
        });

        verifyBtn.addEventListener("click", function () {
          const token = document.getElementById("token-to-verify").value;

          if (!token) {
            alert("Please enter a token to verify");
            return;
          }

          const result = verifyToken(token);

          if (result.valid) {
            document
              .getElementById("payload-tab")
              .querySelector(".token-display").textContent = JSON.stringify(
              result.payload,
              null,
              2,
            );
            document
              .getElementById("headers-tab")
              .querySelector(".token-display").textContent = JSON.stringify(
              result.headers,
              null,
              2,
            );
            document
              .getElementById("signature-tab")
              .querySelector(".token-display").textContent =
              "Signature valid: " + result.signature;

            // Add log entry
            const logContainer = document.querySelector(".logs");
            const time = new Date().toLocaleTimeString();
            logContainer.innerHTML += `<div class="log-entry"><span class="log-time">${time}</span> Token verified successfully for user: ${result.payload.username}</div>`;
            logContainer.scrollTop = logContainer.scrollHeight;

            // Simulate API call
            api.verifyToken().then((response) => {
              if (response.ok) {
                logContainer.innerHTML += `<div class="log-entry"><span class="log-time">${new Date().toLocaleTimeString()}</span> Cloudflare Worker: Token verification successful</div>`;
              } else {
                logContainer.innerHTML += `<div class="log-entry"><span class="log-time">${new Date().toLocaleTimeString()}</span> Cloudflare Worker: Token verification failed</div>`;
              }
              logContainer.scrollTop = logContainer.scrollHeight;
            });
          } else {
            alert("Token verification failed: " + result.reason);

            // Add log entry
            const logContainer = document.querySelector(".logs");
            const time = new Date().toLocaleTimeString();
            logContainer.innerHTML += `<div class="log-entry"><span class="log-time">${time}</span> Token verification failed: ${result.reason}</div>`;
            logContainer.scrollTop = logContainer.scrollHeight;
          }
        });

        // Tab functionality
        tabs.forEach((tab) => {
          tab.addEventListener("click", function () {
            const tabId = this.getAttribute("data-tab");

            // Deactivate all tabs
            tabs.forEach((t) => t.classList.remove("active"));
            tabContents.forEach((tc) => tc.classList.remove("active"));

            // Activate current tab
            this.classList.add("active");
            document.getElementById(`${tabId}-tab`).classList.add("active");
          });
        });

        // Configuration save
        document
          .getElementById("save-config")
          .addEventListener("click", function () {
            securityConfig.storageMethod =
              document.getElementById("cookie-settings").value;
            securityConfig.httpsOnly =
              document.getElementById("https-only").checked;
            securityConfig.sameSite =
              document.getElementById("same-site").checked;
            securityConfig.rateLimiting =
              document.getElementById("rate-limiting").value;

            updateSecurityIndicator();

            // Add log entry
            const logContainer = document.querySelector(".logs");
            const time = new Date().toLocaleTimeString();
            logContainer.innerHTML += `<div class="log-entry"><span class="log-time">${time}</span> Security configuration updated</div>`;
            logContainer.scrollTop = logContainer.scrollHeight;

            alert("Configuration saved successfully!");
          });

        // Initialize security indicator
        updateSecurityIndicator();
      });
    </script>
  </body>
</html>
