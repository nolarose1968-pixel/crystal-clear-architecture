<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ”— Interactive API Testing Hub - Crystal Clear Architecture</title>
    <meta name="description" content="Comprehensive API testing interface with real-time request/response visualization, performance monitoring, and interactive documentation">

    <!-- Monaco Editor for code editing -->
    <script src="https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.min.js"></script>

    <!-- Chart.js for performance visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --bg-light: #f9fafb;
            --bg-white: #ffffff;
            --bg-dark: #1f2937;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --border-radius: 8px;
            --transition: all 0.3s ease;
            --glow: 0 0 20px rgba(37, 99, 235, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-light);
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 40px 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--glow);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            animation: shimmer 4s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 2;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }

        /* API Testing Interface */
        .api-interface {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: var(--bg-white);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid #e5e7eb;
        }

        .panel h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Request Panel */
        .request-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .request-config {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 15px;
            align-items: center;
        }

        .method-select {
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: var(--border-radius);
            font-weight: bold;
            font-size: 14px;
            transition: var(--transition);
        }

        .method-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .method-GET { color: var(--success); }
        .method-POST { color: var(--warning); }
        .method-PUT { color: var(--accent); }
        .method-DELETE { color: var(--error); }

        .url-input {
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: var(--transition);
        }

        .url-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .send-button {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .send-button:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: var(--glow);
        }

        .send-button.sending {
            background: var(--warning);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: var(--transition);
            font-weight: 500;
        }

        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .editor-container {
            height: 300px;
            border: 2px solid #e5e7eb;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .headers-table {
            width: 100%;
            border-collapse: collapse;
        }

        .headers-table th,
        .headers-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .headers-table th {
            background: var(--bg-light);
            font-weight: 600;
        }

        .add-header-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background: var(--bg-light);
            border: 1px solid #e5e7eb;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 14px;
        }

        .add-header-btn:hover {
            background: #e5e7eb;
        }

        /* Response Panel */
        .response-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .response-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .info-item {
            text-align: center;
            padding: 15px;
            background: var(--bg-light);
            border-radius: var(--border-radius);
            border: 1px solid #e5e7eb;
        }

        .info-label {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--primary);
        }

        .response-editor {
            height: 400px;
            border: 2px solid #e5e7eb;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        /* History Panel */
        .history-panel {
            background: var(--bg-white);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .history-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .history-item:hover {
            background: var(--bg-light);
            border-color: var(--primary);
        }

        .history-method {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .history-url {
            flex: 1;
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .history-status {
            font-weight: bold;
        }

        .history-status.success { color: var(--success); }
        .history-status.error { color: var(--error); }
        .history-status.warning { color: var(--warning); }

        .history-time {
            color: var(--text-secondary);
            font-size: 0.8em;
        }

        /* Performance Panel */
        .performance-panel {
            background: var(--bg-white);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .performance-metric {
            text-align: center;
            padding: 20px;
            background: var(--bg-light);
            border-radius: var(--border-radius);
            border: 1px solid #e5e7eb;
        }

        .performance-value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .performance-label {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .performance-chart {
            height: 300px;
            margin-top: 20px;
        }

        /* Loading States */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--bg-light);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius);
        }

        /* Predefined APIs */
        .api-presets {
            background: var(--bg-white);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .presets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .preset-card {
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .preset-card:hover {
            border-color: var(--primary);
            background: var(--bg-light);
        }

        .preset-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .preset-description {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .api-interface {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5em;
            }

            .request-config {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .response-info {
                grid-template-columns: repeat(2, 1fr);
            }

            .performance-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .presets-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ðŸ”— Interactive API Testing Hub</h1>
            <p>Real-time API testing with performance monitoring and interactive documentation</p>
        </div>

        <!-- API Presets -->
        <div class="api-presets">
            <h2>ðŸŽ¯ Quick API Presets</h2>
            <div class="presets-grid">
                <div class="preset-card" data-url="https://jsonplaceholder.typicode.com/posts" data-method="GET">
                    <div class="preset-name">JSONPlaceholder</div>
                    <div class="preset-description">Mock REST API for testing</div>
                </div>
                <div class="preset-card" data-url="https://httpbin.org/get" data-method="GET">
                    <div class="preset-name">HTTPBin</div>
                    <div class="preset-description">HTTP request/response testing</div>
                </div>
                <div class="preset-card" data-url="https://api.github.com/user/repos" data-method="GET">
                    <div class="preset-name">GitHub API</div>
                    <div class="preset-description">GitHub repositories (requires auth)</div>
                </div>
                <div class="preset-card" data-url="https://dashboard-worker.brendawill2233.workers.dev/api/health" data-method="GET">
                    <div class="preset-name">Crystal Clear API</div>
                    <div class="preset-description">Our performance monitoring API</div>
                </div>
                <div class="preset-card" data-url="https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd" data-method="GET">
                    <div class="preset-name">CoinGecko</div>
                    <div class="preset-description">Cryptocurrency prices API</div>
                </div>
                <div class="preset-card" data-url="https://api.openweathermap.org/data/2.5/weather?q=London&appid=demo" data-method="GET">
                    <div class="preset-name">Weather API</div>
                    <div class="preset-description">Weather data (demo key)</div>
                </div>
            </div>
        </div>

        <!-- Main API Testing Interface -->
        <div class="api-interface">
            <!-- Request Panel -->
            <div class="panel request-panel">
                <h2>ðŸ“¤ API Request</h2>

                <!-- Request Configuration -->
                <div class="request-config">
                    <select class="method-select" id="request-method">
                        <option value="GET">GET</option>
                        <option value="POST">POST</option>
                        <option value="PUT">PUT</option>
                        <option value="DELETE">DELETE</option>
                        <option value="PATCH">PATCH</option>
                        <option value="HEAD">HEAD</option>
                        <option value="OPTIONS">OPTIONS</option>
                    </select>
                    <input type="url" class="url-input" id="request-url" placeholder="https://api.example.com/endpoint" value="https://dashboard-worker.brendawill2233.workers.dev/api/health">
                    <button class="send-button" id="send-request">
                        <span class="loading-spinner" id="send-spinner" style="display: none;"></span>
                        Send Request
                    </button>
                </div>

                <!-- Request Tabs -->
                <div class="tabs">
                    <div class="tab active" data-tab="body">Body</div>
                    <div class="tab" data-tab="headers">Headers</div>
                    <div class="tab" data-tab="auth">Auth</div>
                    <div class="tab" data-tab="tests">Tests</div>
                </div>

                <!-- Body Tab -->
                <div class="tab-content active" data-tab="body">
                    <div class="editor-container" id="body-editor"></div>
                </div>

                <!-- Headers Tab -->
                <div class="tab-content" data-tab="headers">
                    <table class="headers-table" id="headers-table">
                        <thead>
                            <tr>
                                <th>Key</th>
                                <th>Value</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="headers-tbody">
                            <tr>
                                <td><input type="text" placeholder="Content-Type" value="Content-Type"></td>
                                <td><input type="text" placeholder="application/json" value="application/json"></td>
                                <td><button class="remove-header">Ã—</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button class="add-header-btn" id="add-header">+ Add Header</button>
                </div>

                <!-- Auth Tab -->
                <div class="tab-content" data-tab="auth">
                    <div class="editor-container" id="auth-editor"></div>
                </div>

                <!-- Tests Tab -->
                <div class="tab-content" data-tab="tests">
                    <div class="editor-container" id="tests-editor"></div>
                </div>
            </div>

            <!-- Response Panel -->
            <div class="panel response-panel">
                <h2>ðŸ“¥ API Response</h2>

                <!-- Response Info -->
                <div class="response-info">
                    <div class="info-item">
                        <div class="info-label">Status</div>
                        <div class="info-value" id="response-status">--</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Time</div>
                        <div class="info-value" id="response-time">--</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Size</div>
                        <div class="info-value" id="response-size">--</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Type</div>
                        <div class="info-value" id="response-type">--</div>
                    </div>
                </div>

                <!-- Response Tabs -->
                <div class="tabs">
                    <div class="tab active" data-tab="response-body">Response</div>
                    <div class="tab" data-tab="response-headers">Headers</div>
                    <div class="tab" data-tab="response-cookies">Cookies</div>
                    <div class="tab" data-tab="response-timeline">Timeline</div>
                </div>

                <!-- Response Body Tab -->
                <div class="tab-content active" data-tab="response-body">
                    <div class="response-editor" id="response-body-editor"></div>
                </div>

                <!-- Response Headers Tab -->
                <div class="tab-content" data-tab="response-headers">
                    <div class="response-editor" id="response-headers-editor"></div>
                </div>

                <!-- Response Cookies Tab -->
                <div class="tab-content" data-tab="response-cookies">
                    <div class="response-editor" id="response-cookies-editor"></div>
                </div>

                <!-- Response Timeline Tab -->
                <div class="tab-content" data-tab="response-timeline">
                    <div class="response-editor" id="response-timeline-editor"></div>
                </div>
            </div>
        </div>

        <!-- Request History -->
        <div class="history-panel">
            <h2>ðŸ“š Request History</h2>
            <div id="request-history">
                <!-- History items will be added here -->
            </div>
        </div>

        <!-- Performance Monitoring -->
        <div class="performance-panel">
            <h2>âš¡ Performance Monitoring</h2>

            <div class="performance-grid">
                <div class="performance-metric">
                    <div class="performance-value" id="avg-response-time">--</div>
                    <div class="performance-label">Avg Response Time</div>
                </div>
                <div class="performance-metric">
                    <div class="performance-value" id="total-requests">--</div>
                    <div class="performance-label">Total Requests</div>
                </div>
                <div class="performance-metric">
                    <div class="performance-value" id="success-rate">--</div>
                    <div class="performance-label">Success Rate</div>
                </div>
                <div class="performance-metric">
                    <div class="performance-value" id="error-count">--</div>
                    <div class="performance-label">Errors</div>
                </div>
            </div>

            <div class="performance-chart">
                <canvas id="performance-chart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Interactive API Testing Hub
        class APITestingHub {
            constructor() {
                this.editors = {};
                this.requestHistory = [];
                this.performanceData = [];
                this.performanceChart = null;

                this.initializeEditors();
                this.setupEventListeners();
                this.initializePerformanceChart();
                this.loadRequestHistory();
            }

            initializeEditors() {
                // Initialize Monaco Editor
                require.config({ paths: { vs: 'https://unpkg.com/monaco-editor@0.45.0/min/vs' } });

                require(['vs/editor/editor.main'], () => {
                    // Request Body Editor
                    this.editors.body = monaco.editor.create(document.getElementById('body-editor'), {
                        value: JSON.stringify({
                            "name": "Crystal Clear Architecture",
                            "version": "2.0.0",
                            "description": "Enterprise-grade domain-driven dashboard system"
                        }, null, 2),
                        language: 'json',
                        theme: 'vs-light',
                        fontSize: 14,
                        minimap: { enabled: false },
                        scrollBeyondLastLine: false
                    });

                    // Auth Editor
                    this.editors.auth = monaco.editor.create(document.getElementById('auth-editor'), {
                        value: `# Authentication Configuration
# Bearer Token
Authorization: Bearer your-token-here

# Basic Auth
Authorization: Basic base64-encoded-credentials

# API Key
X-API-Key: your-api-key-here

# JWT Token
Authorization: JWT your-jwt-token-here`,
                        language: 'plaintext',
                        theme: 'vs-light',
                        fontSize: 14,
                        minimap: { enabled: false }
                    });

                    // Tests Editor
                    this.editors.tests = monaco.editor.create(document.getElementById('tests-editor'), {
                        value: `// API Response Tests
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("Response time is less than 1000ms", function () {
    pm.expect(pm.response.responseTime).to.be.below(1000);
});

pm.test("Response has required fields", function () {
    const jsonData = pm.response.json();
    pm.expect(jsonData).to.have.property('status');
    pm.expect(jsonData.status).to.eql('healthy');
});`,
                        language: 'javascript',
                        theme: 'vs-light',
                        fontSize: 14,
                        minimap: { enabled: false }
                    });

                    // Response editors (read-only)
                    this.editors.responseBody = monaco.editor.create(document.getElementById('response-body-editor'), {
                        value: '// Response will appear here...',
                        language: 'json',
                        theme: 'vs-light',
                        fontSize: 14,
                        readOnly: true,
                        minimap: { enabled: false }
                    });

                    this.editors.responseHeaders = monaco.editor.create(document.getElementById('response-headers-editor'), {
                        value: '// Response headers will appear here...',
                        language: 'plaintext',
                        theme: 'vs-light',
                        fontSize: 14,
                        readOnly: true,
                        minimap: { enabled: false }
                    });

                    this.editors.responseCookies = monaco.editor.create(document.getElementById('response-cookies-editor'), {
                        value: '// Cookies will appear here...',
                        language: 'plaintext',
                        theme: 'vs-light',
                        fontSize: 14,
                        readOnly: true,
                        minimap: { enabled: false }
                    });

                    this.editors.responseTimeline = monaco.editor.create(document.getElementById('response-timeline-editor'), {
                        value: '// Request timeline will appear here...',
                        language: 'plaintext',
                        theme: 'vs-light',
                        fontSize: 14,
                        readOnly: true,
                        minimap: { enabled: false }
                    });
                });
            }

            setupEventListeners() {
                // Tab switching
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', (e) => this.switchTab(e.target));
                });

                // Send request
                document.getElementById('send-request').addEventListener('click', () => this.sendRequest());

                // Add header
                document.getElementById('add-header').addEventListener('click', () => this.addHeader());

                // Remove headers
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('remove-header')) {
                        e.target.closest('tr').remove();
                    }
                });

                // API presets
                document.querySelectorAll('.preset-card').forEach(card => {
                    card.addEventListener('click', () => this.loadPreset(card));
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'Enter') {
                        e.preventDefault();
                        this.sendRequest();
                    }
                });
            }

            switchTab(clickedTab) {
                const tabContainer = clickedTab.closest('.panel');
                const tabName = clickedTab.dataset.tab;

                // Remove active class from all tabs
                tabContainer.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });

                // Add active class to clicked tab
                clickedTab.classList.add('active');

                // Hide all tab contents
                tabContainer.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                // Show selected tab content
                tabContainer.querySelector(`.tab-content[data-tab="${tabName}"]`).classList.add('active');
            }

            async sendRequest() {
                const button = document.getElementById('send-request');
                const spinner = document.getElementById('send-spinner');
                const method = document.getElementById('request-method').value;
                const url = document.getElementById('request-url').value;

                if (!url) {
                    alert('Please enter a URL');
                    return;
                }

                // Update UI for sending
                button.classList.add('sending');
                button.innerHTML = '<span id="send-spinner" class="loading-spinner"></span> Sending...';
                button.disabled = true;

                try {
                    const requestData = this.buildRequestData();
                    const response = await this.makeRequest(requestData);

                    this.displayResponse(response);
                    this.addToHistory(requestData, response);
                    this.updatePerformanceMetrics(response);

                } catch (error) {
                    console.error('Request failed:', error);
                    this.displayError(error);
                } finally {
                    // Reset UI
                    button.classList.remove('sending');
                    button.innerHTML = 'Send Request';
                    button.disabled = false;
                }
            }

            buildRequestData() {
                const method = document.getElementById('request-method').value;
                const url = document.getElementById('request-url').value;

                // Get headers
                const headers = {};
                document.querySelectorAll('#headers-tbody tr').forEach(row => {
                    const inputs = row.querySelectorAll('input');
                    if (inputs[0].value && inputs[1].value) {
                        headers[inputs[0].value] = inputs[1].value;
                    }
                });

                // Get body
                let body = null;
                try {
                    const bodyText = this.editors.body.getValue();
                    if (bodyText.trim()) {
                        body = JSON.parse(bodyText);
                    }
                } catch (e) {
                    body = this.editors.body.getValue();
                }

                return {
                    method,
                    url,
                    headers,
                    body,
                    timestamp: Date.now()
                };
            }

            async makeRequest(requestData) {
                const startTime = performance.now();

                const options = {
                    method: requestData.method,
                    headers: requestData.headers
                };

                if (requestData.body && ['POST', 'PUT', 'PATCH'].includes(requestData.method)) {
                    if (typeof requestData.body === 'object') {
                        options.body = JSON.stringify(requestData.body);
                    } else {
                        options.body = requestData.body;
                    }
                }

                const response = await fetch(requestData.url, options);
                const endTime = performance.now();

                const responseTime = endTime - startTime;
                const responseText = await response.text();

                return {
                    status: response.status,
                    statusText: response.statusText,
                    headers: Object.fromEntries(response.headers.entries()),
                    body: responseText,
                    responseTime,
                    size: responseText.length,
                    type: response.headers.get('content-type') || 'unknown',
                    url: requestData.url,
                    method: requestData.method
                };
            }

            displayResponse(response) {
                // Update response info
                document.getElementById('response-status').textContent = `${response.status} ${response.statusText}`;
                document.getElementById('response-status').className = `info-value status-${response.status >= 200 && response.status < 300 ? 'success' : 'error'}`;

                document.getElementById('response-time').textContent = `${response.responseTime.toFixed(2)}ms`;
                document.getElementById('response-size').textContent = this.formatBytes(response.size);
                document.getElementById('response-type').textContent = response.type;

                // Update response editors
                try {
                    const jsonBody = JSON.parse(response.body);
                    this.editors.responseBody.setValue(JSON.stringify(jsonBody, null, 2));
                    this.editors.responseBody.getModel().setMode('json');
                } catch (e) {
                    this.editors.responseBody.setValue(response.body);
                    this.editors.responseBody.getModel().setMode('plaintext');
                }

                // Headers
                const headersText = Object.entries(response.headers)
                    .map(([key, value]) => `${key}: ${value}`)
                    .join('\n');
                this.editors.responseHeaders.setValue(headersText);

                // Cookies
                const cookies = response.headers['set-cookie'] || [];
                this.editors.responseCookies.setValue(Array.isArray(cookies) ? cookies.join('\n') : 'No cookies set');

                // Timeline
                const timeline = `Request started: ${new Date().toISOString()}
Method: ${response.method}
URL: ${response.url}
Response time: ${response.responseTime.toFixed(2)}ms
Status: ${response.status} ${response.statusText}
Size: ${this.formatBytes(response.size)}
Content-Type: ${response.type}`;
                this.editors.responseTimeline.setValue(timeline);
            }

            displayError(error) {
                document.getElementById('response-status').textContent = 'Error';
                document.getElementById('response-status').className = 'info-value status-error';
                document.getElementById('response-time').textContent = '--';
                document.getElementById('response-size').textContent = '--';
                document.getElementById('response-type').textContent = 'error';

                this.editors.responseBody.setValue(`Error: ${error.message}`);
                this.editors.responseHeaders.setValue('');
                this.editors.responseCookies.setValue('');
                this.editors.responseTimeline.setValue(`Error occurred at: ${new Date().toISOString()}\n${error.message}`);
            }

            addToHistory(request, response) {
                const historyItem = {
                    id: Date.now(),
                    method: request.method,
                    url: request.url,
                    status: response.status,
                    responseTime: response.responseTime,
                    timestamp: new Date().toISOString(),
                    request,
                    response
                };

                this.requestHistory.unshift(historyItem);
                if (this.requestHistory.length > 50) {
                    this.requestHistory = this.requestHistory.slice(0, 50);
                }

                this.saveRequestHistory();
                this.renderHistory();
            }

            renderHistory() {
                const historyContainer = document.getElementById('request-history');

                historyContainer.innerHTML = this.requestHistory.slice(0, 10).map(item => `
                    <div class="history-item" onclick="apiHub.loadFromHistory(${item.id})">
                        <span class="history-method method-${item.method}">${item.method}</span>
                        <span class="history-url">${item.url}</span>
                        <span class="history-status ${item.status >= 200 && item.status < 300 ? 'success' : 'error'}">${item.status}</span>
                        <span class="history-time">${item.responseTime.toFixed(0)}ms</span>
                    </div>
                `).join('');
            }

            loadFromHistory(id) {
                const item = this.requestHistory.find(h => h.id === id);
                if (item) {
                    document.getElementById('request-method').value = item.request.method;
                    document.getElementById('request-url').value = item.request.url;

                    if (item.request.body) {
                        if (typeof item.request.body === 'object') {
                            this.editors.body.setValue(JSON.stringify(item.request.body, null, 2));
                        } else {
                            this.editors.body.setValue(item.request.body);
                        }
                    }

                    this.displayResponse(item.response);
                }
            }

            addHeader() {
                const tbody = document.getElementById('headers-tbody');
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="text" placeholder="Header name"></td>
                    <td><input type="text" placeholder="Header value"></td>
                    <td><button class="remove-header">Ã—</button></td>
                `;
                tbody.appendChild(row);
            }

            loadPreset(card) {
                const url = card.dataset.url;
                const method = card.dataset.method;

                document.getElementById('request-url').value = url;
                document.getElementById('request-method').value = method;

                // Update method select styling
                const methodSelect = document.getElementById('request-method');
                methodSelect.className = `method-select method-${method}`;
            }

            updatePerformanceMetrics(response) {
                this.performanceData.push({
                    timestamp: Date.now(),
                    responseTime: response.responseTime,
                    status: response.status,
                    size: response.size
                });

                // Keep only last 100 data points
                if (this.performanceData.length > 100) {
                    this.performanceData = this.performanceData.slice(-100);
                }

                this.updatePerformanceDisplay();
                this.updatePerformanceChart();
            }

            updatePerformanceDisplay() {
                const data = this.performanceData;

                if (data.length === 0) return;

                const avgResponseTime = data.reduce((sum, item) => sum + item.responseTime, 0) / data.length;
                const successCount = data.filter(item => item.status >= 200 && item.status < 300).length;
                const successRate = (successCount / data.length) * 100;
                const errorCount = data.length - successCount;

                document.getElementById('avg-response-time').textContent = `${avgResponseTime.toFixed(2)}ms`;
                document.getElementById('total-requests').textContent = data.length;
                document.getElementById('success-rate').textContent = `${successRate.toFixed(1)}%`;
                document.getElementById('error-count').textContent = errorCount;
            }

            initializePerformanceChart() {
                const ctx = document.getElementById('performance-chart').getContext('2d');
                this.performanceChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Response Time (ms)',
                            data: [],
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            }

            updatePerformanceChart() {
                const data = this.performanceData.slice(-20); // Last 20 requests

                this.performanceChart.data.labels = data.map(item =>
                    new Date(item.timestamp).toLocaleTimeString()
                );
                this.performanceChart.data.datasets[0].data = data.map(item => item.responseTime);
                this.performanceChart.update();
            }

            loadRequestHistory() {
                const saved = localStorage.getItem('apiTestingHistory');
                if (saved) {
                    this.requestHistory = JSON.parse(saved);
                    this.renderHistory();
                }
            }

            saveRequestHistory() {
                localStorage.setItem('apiTestingHistory', JSON.stringify(this.requestHistory));
            }

            formatBytes(bytes) {
                if (bytes === 0) return '0 B';
                const k = 1024;
                const sizes = ['B', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        }

        // Initialize the API Testing Hub
        let apiHub;
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ðŸ”— Interactive API Testing Hub initializing...');

            // Wait for Monaco Editor to load
            setTimeout(() => {
                apiHub = new APITestingHub();
                console.log('âœ… API Testing Hub ready!');
                console.log('ðŸ’¡ Keyboard shortcut: Ctrl+Enter to send request');
            }, 1000);
        });

        // Global function for history loading
        window.loadFromHistory = function(id) {
            if (apiHub) {
                apiHub.loadFromHistory(id);
            }
        };
    </script>
</body>
</html>
