#!/usr/bin/env bun
/**
 * Global vs Local Configuration Comparison Demo
 * Shows how Bun merges global and local configurations
 */

console.log("üîÑ Global vs Local Configuration Demo");
console.log("=" .repeat(60));

// ============================================================================
// CONFIGURATION FILES OVERVIEW
// ============================================================================
console.log("\nüìÅ Configuration Files:");
console.log("   üåç Global: ~/.bunfig.toml (all projects)");
console.log("   üìÇ Local: ./bunfig.toml (current project only)");
console.log("   ‚ö° CLI: Command line flags (highest priority)");

// ============================================================================
// GLOBAL CONFIGURATION (THEORETICAL)
// ============================================================================
console.log("\nüåç Global Configuration (~/.bunfig.toml):");
const globalConfig = {
  logLevel: "warn",
  telemetry: false,
  console: { depth: 4 },
  test: {
    smol: false,
    coverage: false,
    coverageThreshold: { line: 0.5, function: 0.5, statement: 0.5 }
  },
  install: {
    dev: true,
    optional: true,
    peer: true,
    production: false
  },
  define: {
    "process.env.BUN_GLOBAL_CONFIG": "true",
    "process.env.FIRE22_GLOBAL": "enabled"
  }
};

console.log("   Core Settings:");
Object.entries(globalConfig).forEach(([section, config]) => {
  if (typeof config === "object" && config !== null) {
    console.log(`   üìã ${section}:`);
    if (section === "define") {
      Object.entries(config).forEach(([key, value]) => {
        console.log(`      üîß ${key} = "${value}"`);
      });
    } else {
      Object.entries(config).forEach(([key, value]) => {
        if (typeof value === "object") {
          console.log(`      üìä ${key}: ${JSON.stringify(value)}`);
        } else {
          console.log(`      üìä ${key}: ${value}`);
        }
      });
    }
  } else {
    console.log(`   üìã ${section}: ${config}`);
  }
});

// ============================================================================
// LOCAL CONFIGURATION (ACTUAL)
// ============================================================================
console.log("\nüìÇ Local Configuration (./bunfig.toml):");
const localConfig = {
  logLevel: "warn",
  telemetry: false,
  console: { depth: 2 },
  test: {
    root: "./src",
    preload: ["./test-setup.ts"],
    smol: false,
    coverage: true,
    coverageThreshold: { line: 0.8, function: 0.85, statement: 0.8 },
    coverageSkipTestFiles: true,
    coverageReporter: ["text", "lcov", "html"],
    coverageDir: "./coverage/fire22"
  },
  install: {
    registry: "https://registry.npmjs.org",
    dev: true,
    optional: true,
    peer: true,
    production: false,
    exact: false,
    frozenLockfile: false,
    saveTextLockfile: true,
    linkWorkspacePackages: true,
    linker: "isolated",
    auto: "auto"
  },
  define: {
    "process.env.NODE_ENV": "development",
    "process.env.FIRE22_ENV": "enterprise",
    "__DEV__": true
  },
  resolve: {
    aliases: {
      "@ff": "./",
      "@ff/*": "./*",
      "@/*": "./src/*"
    }
  }
};

console.log("   Project-Specific Settings:");
Object.entries(localConfig).forEach(([section, config]) => {
  if (typeof config === "object" && config !== null) {
    console.log(`   üìã ${section}:`);
    if (section === "define") {
      Object.entries(config).forEach(([key, value]) => {
        const displayValue = typeof value === "string" ? `"${value}"` : value;
        console.log(`      üîß ${key} = ${displayValue}`);
      });
    } else if (section === "resolve" && config.aliases) {
      console.log("      üõ£Ô∏è  aliases:");
      Object.entries(config.aliases).forEach(([alias, path]) => {
        console.log(`         ${alias} ‚Üí ${path}`);
      });
    } else {
      Object.entries(config).forEach(([key, value]) => {
        if (typeof value === "object") {
          console.log(`      üìä ${key}: ${JSON.stringify(value)}`);
        } else if (Array.isArray(value)) {
          console.log(`      üìä ${key}: [${value.join(", ")}]`);
        } else {
          console.log(`      üìä ${key}: ${value}`);
        }
      });
    }
  } else {
    console.log(`   üìã ${section}: ${config}`);
  }
});

// ============================================================================
// MERGE STRATEGY DEMONSTRATION
// ============================================================================
console.log("\nüîÄ Configuration Merge Strategy:");
console.log("   üìä Shallow merge: Local overrides Global");
console.log("   üìä Section-level override (not property-level)");

const mergeExamples = [
  {
    section: "logLevel",
    global: "warn",
    local: "warn",
    result: "warn",
    explanation: "Same value, no conflict"
  },
  {
    section: "console.depth",
    global: 4,
    local: 2,
    result: 2,
    explanation: "Local overrides global"
  },
  {
    section: "test.coverage",
    global: false,
    local: true,
    result: true,
    explanation: "Local enables coverage"
  },
  {
    section: "test.coverageThreshold",
    global: "line=0.5",
    local: "line=0.8,function=0.85",
    result: "line=0.8,function=0.85",
    explanation: "Local threshold overrides global"
  }
];

console.log("\n   Merge Examples:");
mergeExamples.forEach(({ section, global, local, result, explanation }, index) => {
  console.log(`   ${index + 1}. ${section}:`);
  console.log(`      üåç Global: ${global}`);
  console.log(`      üìÇ Local: ${local}`);
  console.log(`      ‚úÖ Result: ${result}`);
  console.log(`      üìù ${explanation}`);
});

// ============================================================================
// CLI OVERRIDE EXAMPLES
// ============================================================================
console.log("\n‚ö° CLI Override Examples:");
const cliExamples = [
  {
    command: "bun install --production",
    override: "production = true",
    explanation: "Override installation mode"
  },
  {
    command: "bun test --coverage",
    override: "coverage = true",
    explanation: "Enable coverage reporting"
  },
  {
    command: "bun --log-level debug",
    override: "logLevel = 'debug'",
    explanation: "Change log verbosity"
  },
  {
    command: "bun install --frozen-lockfile",
    override: "frozenLockfile = true",
    explanation: "Prevent lockfile updates"
  },
  {
    command: "bun test --coverage-reporter lcov",
    override: "coverageReporter = ['lcov']",
    explanation: "Change coverage output format"
  }
];

cliExamples.forEach(({ command, override, explanation }, index) => {
  console.log(`   ${index + 1}. ${command}`);
  console.log(`      üéØ Overrides: ${override}`);
  console.log(`      üìù ${explanation}`);
});

// ============================================================================
// PRACTICAL SCENARIOS
// ============================================================================
console.log("\nüéØ Practical Configuration Scenarios:");

const scenarios = [
  {
    name: "Development Environment",
    global: "Base settings (logLevel=warn, dev=true)",
    local: "Project specifics (coverage=true, custom aliases)",
    cli: "bun install (uses merged config)",
    result: "Full dev environment with project coverage"
  },
  {
    name: "Production Build",
    global: "Base settings",
    local: "Project settings",
    cli: "bun install --production --frozen-lockfile",
    result: "Production-optimized with locked dependencies"
  },
  {
    name: "CI/CD Pipeline",
    global: "Base settings",
    local: "Project settings",
    cli: "bun test --coverage --frozen-lockfile",
    result: "Quality gates with coverage and locked deps"
  },
  {
    name: "Debug Session",
    global: "logLevel=warn",
    local: "Project settings",
    cli: "bun --log-level debug --verbose",
    result: "Maximum verbosity for debugging"
  }
];

scenarios.forEach(({ name, global, local, cli, result }, index) => {
  console.log(`\n   ${index + 1}. ${name}:`);
  console.log(`      üåç Global: ${global}`);
  console.log(`      üìÇ Local: ${local}`);
  console.log(`      ‚ö° CLI: ${cli}`);
  console.log(`      ‚úÖ Result: ${result}`);
});

// ============================================================================
// CONFIGURATION VALIDATION
// ============================================================================
console.log("\n‚úÖ Configuration Validation:");

const validationChecks = [
  { check: "TOML syntax is valid", status: true, icon: "‚úÖ" },
  { check: "Section names are recognized", status: true, icon: "‚úÖ" },
  { check: "Property values are valid types", status: true, icon: "‚úÖ" },
  { check: "Paths resolve correctly", status: true, icon: "‚úÖ" },
  { check: "Aliases don't conflict", status: true, icon: "‚úÖ" },
  { check: "Security settings are configured", status: true, icon: "‚úÖ" }
];

validationChecks.forEach(({ check, status, icon }) => {
  console.log(`   ${icon} ${check}`);
});

// ============================================================================
// RECOMMENDED CONFIGURATION STRUCTURE
// ============================================================================
console.log("\nüìã Recommended Configuration Structure:");

console.log("\n   üåç Global (~/.bunfig.toml):");
console.log("   ‚Ä¢ Organization-wide defaults");
console.log("   ‚Ä¢ Security policies");
console.log("   ‚Ä¢ Performance settings");
console.log("   ‚Ä¢ Development tooling");

console.log("\n   üìÇ Local (./bunfig.toml):");
console.log("   ‚Ä¢ Project-specific settings");
console.log("   ‚Ä¢ Custom aliases and paths");
console.log("   ‚Ä¢ Test configurations");
console.log("   ‚Ä¢ Build optimizations");

console.log("\n   ‚ö° CLI Flags:");
console.log("   ‚Ä¢ Environment overrides");
console.log("   ‚Ä¢ One-off changes");
console.log("   ‚Ä¢ Debug settings");
console.log("   ‚Ä¢ CI/CD customizations");

// ============================================================================
// ENTERPRISE BEST PRACTICES
// ============================================================================
console.log("\nüè¢ Enterprise Configuration Best Practices:");

const bestPractices = [
  "Use global config for organization standards",
  "Keep local config for project specifics",
  "Document configuration overrides",
  "Use environment variables for secrets",
  "Validate configurations in CI/CD",
  "Version control both config files",
  "Test configuration changes",
  "Document configuration hierarchy"
];

bestPractices.forEach((practice, index) => {
  console.log(`   ${index + 1}. ${practice}`);
});

console.log("\nüéâ Global vs Local Configuration Demo Complete!");
console.log("   Your Fire22 project now has enterprise-grade configuration management!");
